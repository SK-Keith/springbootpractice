<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据字典生成页面</title>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

</head>
<body>
<h1>输入</h1>
<table>
    <tr>
        <td>连接url</td>
        <td><input type="text" name="connectionUrl" value="jdbc:mysql://10.19.174.11:3306"></td>
    </tr>
    <tr>
        <td>username</td>
        <td><input type="text" name="username" value="lxdev"></td>
    </tr>
    <tr>
        <td>password</td>
        <td><input type="password" name="password" value="db@LX4devtmp123"></td>
    </tr>
    <tr>
        <td><input type="button" value="连接数据库服务器" id="testConnection"></td>
        <td><input type="button" value="重置输入参数" id="resetInput"></td>
    </tr>
</table>

<h1>选择数据库</h1>
<div>请选择数据库【连接数据库服务器之后可以自动生成出来】</div>
<div id="databaseSel"></div>
<div><input type="button" value="生成选定数据库的数据字典" id="generateDataDict"></div>
<h1>生成的数据字典</h1>
<div>
    <textarea id="markdownContent" rows="30" cols="100">
    </textarea>
</div>
<h2>提示信息</h2>
<h1 id="errorMsg"></h1>
</body>
<script type="text/javascript">
    $("#resetInput").click(function () {
        $("input[name='connectionUrl']").val("");
        $("input[name='username']").val("");
        $("input[name='password']").val("");

    });
    $("#testConnection").click(function () {
        let connectionUrl = $("input[name='connectionUrl']").val();
        let username = $("input[name='username']").val();
        let password = $("input[name='password']").val();
        $.post("/testConnection",
            {connectionUrl: connectionUrl, username: username, password: password},
            function (data) {
                var content = data.msg;
                $("#errorMsg").empty().append(content);
                var selectHtml = "";
                data.data.databaseList.forEach(function (databaseName) {
                    selectHtml += '<input  name="databaseName" type="checkbox" value="' + databaseName + '">' + databaseName;
                });
                $("#databaseSel").empty().append(selectHtml);
            }, "json");
    });
    $("#generateDataDict").click(function () {
        let databaseName = "";
        $.each($('input:checkbox:checked'), function () {
            databaseName += $(this).val() + ",";
        });
        $.post("/generateDataDict",
            {databaseName: databaseName},
            function (data) {
                var content = data.data.markdownContent;
                $("#markdownContent").empty().append(content);
            }, "json");
    });

</script>
</html>
